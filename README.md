Примерное ТЗ.
1.	Пациент вводит исходные данные: ФИО, возраст пол, данные о физической активности, и 
а) результат инструментального измерения своего базового метаболизма (некое число), 
б) (при отсутствии результата инструментального измерения) рост, вес, возможно, окружность бедра и/или запястья (это пока уточняется).
А также предпочтения и противопоказания: непереносимость лактозы, безглютеновая диета, вегетарианство разной степени.
2.  На основании введённых данных по существующей формуле вычисляется значение базового метаболизма пациента.
3. В соответствии с полученным по формуле или введённым на основании инструментального измерения значения базового метаболизма, пациент получает заранее составленную формулу дневного рациона из 6 групп продуктов: Б, Ж, К, Ф, М, О (Пример: 6Б4Ж5К3Ф7О). Эти формулы рассчитаны заранее для разных значений и сведены в таблицу.
4. Пациент выбирает 1 из 2х вариантов дневной разбивки приёмов пищи: завтрак/обед/ужин с 1м перекусом или с 2-мя перекусами (т.е. 4 или 5 приёмов пищи).
5. В зависимости от выбранного варианта формула дневного рациона разбивается на рекомендуемые формулы для каждого приёма пищи. Эти разбивки выполнены заранее и сведены в общую таблицу (возможно в дальнейшем сделаем алгоритм разбивки) из которой и выбираются варианты разбивки для каждого случая.
6. Пациент приступает к подбору продуктов с помощью базы данных продуктов:
Пример: он получил рекомендуемую формулу завтрака 2Б1Ж1Ф, нажал на букву Б и открылось окошко базы данных белковых продуктов с единичными порциями, он выбрал, например, творог 5% - 50г-1Б, нажал 1 раз, получил в меню 50г творога, далее либо нажал + и добавил еще 1 порцию творога (при этом в окошке «формула вашего завтрака» появляется значение 2Б), либо снова зашёл в базу и добавил другой белковый продукт. Также нажимая другие буквы в «рекомендуемой формуле завтрака» пациент попадает в базу других продуктов и набирает свой итоговый набор продуктов.
7. Если «формула вашего завтрака» не совпадает с «рекомендуемой формулой завтрака», то происходит автоматическое изменение формул оставшихся приёмов пищи: в них либо добавляется неиспользованный в завтрак продукт, либо убирается продукт, который был дополнительно включён в завтрак (алгоритм уточним).  Так же происходит перераспределение и в случае пропуска пациентом приёма пищи. Если «формула вашего завтрака» совпадает с «рекомендуемой формулой завтрака», то такого изменения не происходит.
8. Аналогично происходит выбор продуктов для каждого приёма пищи.
9. Существуют ограничения: например, алгоритм будет сигнализировать в случае выбора Ф (фрукта) на ужин или переноса на ужин этого продукта, если он не был выбран в предыдущие приёмы пищи. В этом случае во время выбора продуктов последнего перед ужином приёма пищи данное обозначение в формуле (Ф) загорится красным и появится надпись «рекомендуем выбрать этот продукт – его нельзя переносить на ужин!». Есть и другие ограничения, которые будут доработаны позднее. Но пациент будет иметь возможность сделать свой выбор, даже если он не рекомендован. В этом случае у его «формулы вашего ужина» будет сопроводительное сообщение «нерекомендованый набор продуктов».
10. База данных представляет собой таблицу 6 видов продуктов с указанием их единичных порций. Некоторые единичные порции могут относиться к 2м видам продуктов, например, яйцо. (В качестве примера прилагаем сокращенный вариант этой таблицы). Эта таблица должна иметь возможность изменения и расширения.
11. В случае введенных пациентом исходных предпочтений или ограничений (вегетарианство того или иного толка, непереносимость глютена и т.п.) он получает доступ только к той части таблицы (тем продуктам), которые ему не противопоказаны. Т.е., значит, в эту таблицу будут введены ещё дополнительные атрибуты для каждого продукта, связанные с этим набором ограничений (итоговый набор атрибутов уточним).






Расчетный алгоритм.
2-й этап.
Составление индивидуального меню
Пример. Получена формула индивидуального дневного рациона:
М1 Ф2 О4 К3 Б7 Ж5
Пояснение: М – группа молочных, Ф – группа фруктов, К – группа крахмалистых, Б – группа белковых, Ж – группа жиров
Вопрос: «Рассчитать меню? Да/нет
Если Да:
Надпись:
1-й прием пищи
Выберите группу продуктов (нажмите на букву в формуле). Например Б
При нажатии попадаем в базу данных (таблица единичных порций), в группу, соответствующую выбранной букве. При этом остальные группы не видны. Если при введении входных данных были введены пищевые ограничения (см. скорректированный предыдущй алгоритм – входные данные), то строки с данными ограничениями скрываются (отмечены в таблице крестиками).
Надпись: выберите продукт.
После нажатия на выбранный продукт (например, индейка филе)
Появляется надпись: выбрано Филе индейки 30гр – Б1 (остаток в рационе Б6)
Появляется надпись добавить количество порций, да/нет?
Если да, то появляется +/-, при нажатии на них добавляется или уменьшается количество порций.
Например, нажали + 2 раза, появился итог: выбрано филе индейки 90гр – Б3 (остаток в рационе Б4)
Надпись: продолжить выбор из этой группы/перейти в другую/завершить формирование текущего приема пищи.
Если продолжить…., то цикл повторяется аналогично. 
Если перейти в другую, то переход в другую и повтор цикла. 
Если завершить…, то на экране появляется итоговое меню текущего приёма пищи.
Например,
1-й приём пищи: О2 Б6
Огурцы – 200гр
Филе индейки – 90гр
Формула остатка рациона: М1 Ф2 О2 К3 Б4 Ж5
Если во время 1-го и 2-го приёма пищи не была использована группа Ф (фрукты), то появляется надпись: «Рекомендуем съесть фрукт. Фрукты лучше употреблять в 1-й половине дня»
Перейти в группу Ф фрукты/завершить.
Далее повтор алгоритма в зависимости от выбора.
После формирования итогового меню текущего приёма пищи появляется вопрос:
«Установить таймер напоминания о следующем приёме?» Да/нет
Если ДА, то появляется вопрос: через сколько минут вы планируете текущий приём пищи?
Сейчас/через _____(впечатать) минут
Включить звуковой сигнал да/нет
Далее от текущего времени отсчитывается 2,5 часа и срабатывает таймер со звуковым сигналом
И появляется надпись: «через 30 минут следующий приём пищи. Приступить к расчёту меню?» да/позже
Если да, то процедура повторяется, только теперь везде пишется «2-й прием пищи»
Если позже, то повторный сигнал срабатывает через 30 минут и появляется надпись: «в течение часа рекомендуем вам принять пищу. Приступить к расчету меню?» Да/позже
Если да, то делаем по алгоритму, только теперь везде пишется «2-й прием пищи»
Если позже, то повторный сигнал срабатывает через 45 минут и появляется надпись: «До окончания 2-го приёма пищи осталось 15 минут. Приступить к расчету меню?» Да/позже
Если да, то делаем по алгоритму, если позже, то следующий сигнал через 15 минут с надписью: «время 2-го приёма пищи заканчивается. Приступить к расчету меню?» Да/позже
Если да, то по алгоритму, если позже, то надпись: «Таймер уведомлений отключён. При необходимости расчёта 2-го приёма пищи вновь зайдите в приложение и нажмите клавишу «Приступить к расчёту меню»
Далее, на экране всегда горит клавиша «рассчитать меню» пока ее не нажмут т тогда начнётся работа по предыдущему алгоритму.
 Далее алгоритм повторяется для 3-го и 4-го приёма пищи.
Сброс алгоритма текущего дня происходит в 3 часа ночи и начинает работать алгоритм нового дня, т.е. сначала с 1-го приёма пищи.

Некоторые особенности при работе алгоритма:
Некоторые продукты в базе единичных порций имеют дополнительные группы (т.е. могут принадлежать к нескольким группам).  Например, Хумус. Если мы заходим в группу Б (белковые), выбираем (нажимаем) «Хумус» (единичная порция 30гр), то при выборе появляется его формула Б1 К1 Ж1. Т.е. выбрав 1 категорию «белковые» Хумус мы закрываем сразу позиции в трёх группах, и если  формула индивидуального дневного рациона была, например,  М1 Ф2 О4 К3 Б7 Ж5, то после выбора 1 порции Хумуса формула остатка рациона станет: М1 Ф2 О4 К2 Б6 Ж4.
Если при выборе такого продукта оказывается, что позиции в дополнительных категориях (например, К и Ж для Хумуса) уже были выбраны ранее (равны 0 и уменьшать их уже некуда), то появляется уведомление: «Вы не можете выбрать данный продукт в рамках вашего дневного рациона, т.к. он содержит в составе порции других продуктовых групп, которые вы уже полностью использовали. Выберите другой продукт.» Выбрать другой продукт? ДА/НЕТ. Если НЕТ, то уведомление: «Внимание, вы выбрали продукт, который привёл к изменению формулы вашего дневного рациона. Это препятствует достижению вашей цели. Изменённая формула вашего рациона на сегодняшний день: ____________ (здесь появляется новая формула, в которой увеличивается цифра той группы продуктов, в которой произошло превышение). Данная формула действует до конца текущего дня. Со следующего дня происходит возврат к первоначальной формуле.
Такие продукты в базе единичных порций помещаются в каждую из этих групп, а в столбце «доп. группы» указываются количества порций из других групп.
Аналогичное происходит, если пациент решает выбрать количество порций любого продукта больше, чем указано в формуле дневного рациона. Тогда появляется уведомление: «Вы не можете выбрать больше продуктов из данной группы в рамках вашего дневного рациона, т.к. вы уже выбрали максимальное количество. Выберите продукт из другой группы.» Выбрать продукт из другой группы? ДА/НЕТ. Если НЕТ, то разрешается выбрать продукт, а после выбора появляется уведомление: «Внимание, вы выбрали продукт, который привёл к изменению формулы вашего дневного рациона. Это препятствует достижению вашей цели. Изменённая формула вашего рациона на сегодняшний день: ____________ (здесь появляется новая формула, в которой увеличивается цифра той группы продуктов, в которой произошло превышение). Данная формула действует до конца текущего дня. Со следующего дня происходит возврат к первоначальной формуле.
Всплывающие уведомления при работе алгоритма (кроме вышеперечисленных):
1-й вариант, входные данные «Снижение веса»:
Если при выборе продуктов за один приём пищи количество порций Б>4 (для мужчин) и Б>3 (для женщин), то всплывает предупреждение: «Количество белковых порций за 1 приём при снижении веса не должно превышать 4. Рекомендуем выбрать другой продукт.» (для женщин, соответственно, не должно превышать 3). Данное уведомление носит рекомендательный характер и не препятствует дальнейшей работе алгоритма, если пациент ему не последует. 
Если во время первых 2-х приёмов пищи пациент не выбрал полностью всё количество продуктов К и Ф, то перед расчетом 3-го приёма пищи появляется уведомление: «Рекомендуем выбрать полностью оставшееся количество крахмалистых (К) и фруктов (Ф) т.к. крахмалистые и фрукты не рекомендуется употреблять на ужин при снижении веса».

2-й вариант, входные данные «Сохранение веса»:
Если при выборе продуктов за один приём пищи количество порций Б>5 (для мужчин) и Б>4 (для женщин), то всплывает предупреждение: «Количество белковых порций за 1 приём при снижении веса не должно превышать 5. Рекомендуем выбрать другой продукт.» (для женщин, соответственно, не должно превышать 4). Данное уведомление носит рекомендательный характер и не препятствует дальнейшей работе алгоритма, если пациент ему не последует. 
Если после первых 2-х приёмов пищи осталось более 1 порции продуктов К и Ф (каждого), то перед расчетом 3-го приёма пищи появляется уведомление: «Рекомендуем выбрать крахмалистые (К) и фрукты (Ф), чтобы на ужин не оставить не более 1-й порции крахмалистых (К) и фруктов (Ф)».
Дополнительно.
В постоянном режиме должна присутствовать маленькая клавиша где-нибудь в уголке «изменить входные данные»
Также желательна где-нибудь в уголке клавиша «включить постоянный таймер напоминаний». После включения: «постоянный таймер напоминаний включён. Отключить постоянный таймер?» При включенном постоянном таймере после формирования меню каждого приёма пищи вопрос о включении таймера не появляется. Остальное - по алгоритму.

База единичных порций должна быть 1) пополняемая, 2) иметь возможность поиска по начальным набираемым буквам КАЖДОГО слова (например, Рис дикий и рис Дикий, и пот Р и по Д, и по набору следующих букв)
Хорошо, если будет возможность  отдельного алгоритма работы только с базой, чтобы на основании  выбора продуктов из базы создавать формулу конкретного блюда с указанием не только нашей продуктовой формулы, но и итогового бжу и калорийности. Этот алгоритм я пропишу позже, но надо учесть этот вариант, чтобы где-то разместить клавишу «расчет блюд» (это вне рамок программы)
